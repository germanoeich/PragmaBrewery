# PragmaBrewery

## Questions / Assumptions 
- Can Shane install a small server on his truck?  
Assumption: Yes, it's possible to install a small server on the truck.

- What kind of communication interface is available to get the data from the beer container to the server?  
Assumption: Either the boxes are connected directly to the server or there's a local network capable of transporting the data.

- How will Shane visualize the data?  
Assumption: Shane has a tablet or laptop with a browser on the truck's panel.

- How are we going to identify each beer container and the type of beer that's inside?  
Assumption: Each beer container is previously configured to be aware of the ID of the beer type it's holding and to have a unique ID. The container is capable of transmitting that information along with the temperature data.

## Running
To run this project you need:
- docker - https://www.docker.com/community-edition#/download
- docker-compose - https://docs.docker.com/compose/install/
- yarn - https://yarnpkg.com/en/docs/install

### Building the containers:
On the project root, run
```
sh build.sh
```
as root or with a sudoer user.

### Running the tests
Inside the api folder, run
```
yarn test
```

There are no tests for the website, see the "What could be improved" section for more info on that.

### Spinning up the project:
After building the project, run
```
sudo docker-compose up
```
The dashboard will be empty in the first few seconds. As the API dataset gets populated, the dashboard will too.

This will also start the thermometer-mock project, which will simulate data flowing from the beer containers to the API.
In case you don't want the mock to start, run:
```
sudo docker-compose up api web
```
Please note that the dashboard will be empty, since we dynamically add the components based on available data.

## Tech Stack
#### API
The API is made in Javascript, using node and ES6+. It's transpiled with Babel.
There's only a single REST route, for the temperatures, which is used to update thermometer data. There's a GET method on this route too, but it's not used by the web application. The main communication interface between the site and the API is a websocket. Once the client connects to the API, a `sync` event will be sent with all the data available. Every time the API receives new data an `update` event will be sent to every connected client to notify the pages that the data has changed.

#### Web
The site is made with Javascript and React. The boilerplate code for the website was generated by create-react-app. There's only a single page, which displays information about the thermometers connected. It's dynamic, so once a new thermometer sends data to the API the site will automatically add a new component for it. The graphs are using Chart.js.

#### Thermometer-mock
Quick and dirty application for mocking thermometer data. Made with Javascript and node. There's some customizability to it, you can set the interval to be random or fixed, you can change the number of thermometers mocked and the mode by which beer types get picked on mocks. Check the env file for the options

#### Highlights
- The code uses a fair amount of event emitters. When working with WebSockets, being able to seamlessly emit and listen to events is a must. EventEmitter3 was picked because it's generally faster than Node's implementation.
- The API uses Standard JS as the code style.
- The communication between the API and website was made to be efficient. This will come in handy if for some reason the data has to be accessed through the internet and will save data from the mobile network.
- Storage is abstracted away from the app, meaning it's possible to drop in a new storage class for Mongo or Redis, if ever needed.
- The API is made to support unlimited containers (provided they all have a unique ID and associated beer type registered with the API), so if the API was to be moved to a remote server to monitor multiple trucks, little to no change would need to be made.

#### What could be improved
- Responsiveness for the site is there but is not perfect. Some specific resolutions will look weird.
- The graphs could be better. Responsiveness from Chart.js is somewhat bad, and some horizontal lines for the max and min temps would be useful.
- Tests. For. The. Site. I admit I'm very disappointed at myself for letting this one slip, but problems with Canvas and WebSockets when testing, the fact I didn't really know how long it would take to fix those and a limited time constraint made me drop the tests for the frontend. Writing this 2 hours from the deadline, I think it was for the best.
- React part is sorta messy. The BeerThermometer component should be divided into Container and Component because there's logic in it.
- If this site was ever to be expanded, Redux would be a good addition. I don't think the site benefits from Redux right now because it's a 2 component site with little logic and a single update source. Less or Sass would also make a good addition, but again, for the amount of CSS in this code base it's not worth the effort of settting it up. 